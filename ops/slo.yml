# ops/slo.yml
windows:
  reporting: 30d         # агрегирование SLO
  alert_eval: 1h         # как часто считаем алерты
task_classes:
  - id: docgen
    slo:
      e2e_lead_time_p95: "≤ 25m"
      success_rate: "≥ 95%"
      cost_p95_usd: "≤ 0.70"
  - id: feature_xs
    slo:
      e2e_lead_time_p95: "≤ 40m"
      success_rate: "≥ 90%"
      cost_p95_usd: "≤ 1.20"
  - id: feature_s
    slo:
      e2e_lead_time_p95: "≤ 60m"
      success_rate: "≥ 85%"
      cost_p95_usd: "≤ 2.00"
error_budget:
  metric: success_rate
  policy:
    warn: "spent >= 50%"   # код-фриз фич
    freeze: "spent >= 100%"# блок новых задач класса
sli:
  - id: e2e_lead_time_p95
    source: db
    query_ref: app.sql.sli.e2e_lead_time_p95
  - id: step_latency_p95
    source: db
    query_ref: app.sql.sli.step_latency_p95
  - id: success_rate
    source: db
    query_ref: app.sql.sli.success_rate
  - id: pr_quality_rate
    source: db
    query_ref: app.sql.sli.pr_quality_rate
  - id: cost_p95_usd
    source: db
    query_ref: app.sql.sli.cost_p95_usd
  - id: tokens_p95
    source: db
    query_ref: app.sql.sli.tokens_p95
  - id: queue_start_time_p95
    source: db
    query_ref: app.sql.sli.queue_start_time_p95
alerts:
  routes:
    - channel: telegram
      to: ${TELEGRAM_CHAT_ID}
      on: [warn, freeze]
