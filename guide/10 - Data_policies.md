10 «Политики данных» в целом реализован. Ниже сжатая оценка и точечные добивки без конфликтов с п.9.

# Что ок

- Приватность и запрет PII в логах зафиксированы в constraints; retention для логов/метрик/артефактов предусмотрен, автоматическая очистка через задачи допустима. &#x20;
- Роли БД и доступ к схемам прописаны: разделение `app/pii/audit`, выборочные GRANT’ы, доступ к PII только через маскированное представление `pii.user_redacted`.&#x20;
- Аудит операторских действий определён как таблица `audit.operator_action` с хеш-цепочкой и требованиями к UI-следу. &#x20;
- Секреты вынесены в SOPS/age, ротация и RBAC для n8n отражены. &#x20;
- Где хранится телеметрия: логи/метрики/трейсинг с корреляцией, дашборды и алерты описаны.&#x20;

# Пробелы и риски

1. Нет явного **каталога данных** с классификацией полей и сроками хранения по объектам. Сейчас retention сформулирован общими словами.&#x20;
2. **RLS-политики** показаны точечно на `pii.user`, нет правила «RLS по умолчанию + deny-by-default» для всех будущих PII-таблиц.&#x20;
3. **DSR-процедуры** (export/delete по GDPR) не описаны: кто запускает, как идентифицируется субъект, какие таблицы затрагиваются.&#x20;
4. **Скрамблинг payload’ов событий/логов** оговорён принципом «без чувствительных данных», но нет проверяемых правил или lint’а схем событий.&#x20;
5. **Backups/шифрование на уровне БД** не уточнены: кто имеет доступ, шифрование снапшотов, срок хранения бэкапов.&#x20;

# Что добавить минимально

## 1) Каталог данных

Создай `ops/data-catalog.md` + простую схему для артефактов каталога:

- Классы: `public`, `internal`, `operational`, `pii`, `secret`.
- Табло: `dataset`, `table`, `field`, `class`, `retention_days`, `owner`, `pii_rule` (mask|hash|deny).
- Сопоставь ключевые таблицы: `app.run`, `app.event_log`, `audit.operator_action`, `pii.user`, `pii.user_redacted`. Основание: сейчас лишь общая оговорка о ретеншне.&#x20;

## 2) Базовая «сетка» RLS

В `db/seeds/seed.sql` добавь дефолты, чтобы новые PII-таблицы были закрыты по умолчанию:

```sql
-- enforce RLS by default for pii schema
DO $$
DECLARE r record;
BEGIN
  FOR r IN SELECT tablename FROM pg_tables WHERE schemaname='pii' LOOP
    EXECUTE format('ALTER TABLE pii.%I ENABLE ROW LEVEL SECURITY', r.tablename);
  END LOOP;
END $$;

-- block all by default, allow only svc role
CREATE POLICY pii_deny_all ON pii."user" FOR SELECT USING (false);
CREATE POLICY pii_service_only ON pii."user" FOR SELECT USING (current_user = 'svc_quanta');
```

Опирается на существующий пример и усиливает «deny-by-default».&#x20;

## 3) Правила «no-PII-in-logs/events»

В `docs/90_api.md` добавь проверяемые правила:

- События содержат только `run_id`, `project_id`, агрегаты и технические коды ошибок.
- Любые поля, похожие на e-mail, телефоны, ФИО или токены, запрещены.
- Ссылку на `_schemas/error.schema.json` и `_schemas/api.schema.json` сделать блокирующей в CI (`validate:api`). Основание: сейчас правила сформулированы декларативно.&#x20;

## 4) DSR-runbook

В `docs/70_runbook.md` добавь раздел `## Data Subject Requests`:

- Команда: оператор создает тикет, секьюрити-аудитор подтверждает.
- Экспорт: выбирается субъект по `user_id` или стабильному хэшу, выгрузка только из `pii.user_redacted` + связанных артефактов.
- Удаление: soft-delete с отложенным hard-purge по ретеншну, исключая аудит-трейл если закон не требует удаления.&#x20;

## 5) Backups и доступ

В `docs/60_constraints.md → Compliance` дополни:

- Backups: encrypt-at-rest, доступ только `sec_auditor`, хранение ≤ 30/90 дней по классам данных; доступ аудитируется. Основание: раздел Compliance уже есть, но без бэкапов.&#x20;

# Acceptance п.10

- ✅ Есть `ops/data-catalog.md` с таблицей полей и классами данных.
- ✅ В сиды добавлены RLS-дефолты для всех таблиц `pii.*`.&#x20;
- ✅ `90_api.md` содержит жёсткие правила «no-PII», CI валидирует примеры событий против схем.&#x20;
- ✅ В `70_runbook.md` описаны DSR-процедуры.&#x20;
- ✅ В `60_constraints.md` дополнён блок про шифрование бэкапов и сроки хранения.&#x20;
